#!/bin/bash
#
# Commit message hook to enforce conventional commit format
# Format: <type>: <description>
#
# Types: feat, fix, refactor, test, docs, chore, style, perf
#

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Skip merge commits
if echo "$COMMIT_MSG" | grep -q "^Merge"; then
    exit 0
fi

# Check for conventional commit format
PATTERN="^(feat|fix|refactor|test|docs|chore|style|perf)(\(.+\))?: .{1,72}"

if ! echo "$COMMIT_MSG" | head -1 | grep -qE "$PATTERN"; then
    echo ""
    echo "‚ùå Invalid commit message format!"
    echo ""
    echo "Expected format: <type>: <description>"
    echo ""
    echo "Types:"
    echo "  feat     - New feature"
    echo "  fix      - Bug fix"
    echo "  refactor - Code refactoring"
    echo "  test     - Adding or updating tests"
    echo "  docs     - Documentation changes"
    echo "  chore    - Maintenance tasks"
    echo "  style    - Code style/formatting"
    echo "  perf     - Performance improvements"
    echo ""
    echo "Examples:"
    echo "  feat: Add user authentication"
    echo "  fix: Resolve null pointer in ProfileService"
    echo "  test: Add coverage for AccountGroup aggregate"
    echo ""
    echo "Your message: $COMMIT_MSG"
    echo ""
    exit 1
fi

exit 0
